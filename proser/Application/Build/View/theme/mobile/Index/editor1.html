<extend name="./base/layoutmobile" />
<block name="body">
	<link href="__PUBLIC__/editor_files/main.css" rel="stylesheet">
	<link id="theme" href="__PUBLIC__/editor_files/editor_mobile.css" rel="stylesheet">
	<script src="__PUBLIC__/editor_files/three_002.js"></script>
	<script src="__PUBLIC__/editor_files/system.js"></script>

	<script src="__PUBLIC__/editor_files/EditorControls.js"></script>
	<script src="__PUBLIC__/editor_files/TransformControls.js"></script>
	<script src="__PUBLIC__/editor_files/OrbitControls.js"></script>

	<script src="__PUBLIC__/editor_files/jszip.js"></script>
	<script src="__PUBLIC__/editor_files/inflate.js"></script> <!-- FBX -->

	<script src="__PUBLIC__/editor_files/AMFLoader.js"></script>
	<script src="__PUBLIC__/editor_files/AWDLoader.js"></script>
	<script src="__PUBLIC__/editor_files/BabylonLoader.js"></script>
	<script src="__PUBLIC__/editor_files/ColladaLoader2.js"></script>
	<script src="__PUBLIC__/editor_files/FBXLoader.js"></script>
	<script src="__PUBLIC__/editor_files/GLTFLoader.js"></script>
	<script src="__PUBLIC__/editor_files/KMZLoader.js"></script>
	<script src="__PUBLIC__/editor_files/MD2Loader.js"></script>
	<script src="__PUBLIC__/editor_files/OBJLoader.js"></script>
	<script src="__PUBLIC__/editor_files/MTLLoader.js"></script>
	<script src="__PUBLIC__/editor_files/PlayCanvasLoader.js"></script>
	<script src="__PUBLIC__/editor_files/PLYLoader.js"></script>
	<script src="__PUBLIC__/editor_files/STLLoader.js"></script>
	<script src="__PUBLIC__/editor_files/TGALoader.js"></script>
	<script src="__PUBLIC__/editor_files/TDSLoader.js"></script>
	<script src="__PUBLIC__/editor_files/UTF8Loader.js"></script>
	<script src="__PUBLIC__/editor_files/VRMLLoader.js"></script>
	<script src="__PUBLIC__/editor_files/VTKLoader.js"></script>
	<script src="__PUBLIC__/editor_files/lzma.js"></script>
	<script src="__PUBLIC__/editor_files/ctm.js"></script>
	<script src="__PUBLIC__/editor_files/CTMLoader.js"></script>
	<script src="__PUBLIC__/editor_files/OBJExporter.js"></script>
	<script src="__PUBLIC__/editor_files/GLTFExporter.js"></script>
	<script src="__PUBLIC__/editor_files/STLExporter.js"></script>

	<script src="__PUBLIC__/editor_files/Projector.js"></script>
	<script src="__PUBLIC__/editor_files/CanvasRenderer.js"></script>
	<script src="__PUBLIC__/editor_files/RaytracingRenderer.js"></script>
	<script src="__PUBLIC__/editor_files/SoftwareRenderer.js"></script>
	<script src="__PUBLIC__/editor_files/SVGRenderer.js"></script>

	<link rel="stylesheet" href="__PUBLIC__/editor_files/codemirror.css">
	<link rel="stylesheet" href="__PUBLIC__/editor_files/monokai.css">
	<script src="__PUBLIC__/editor_files/codemirror.js"></script>
	<script src="__PUBLIC__/editor_files/javascript.js"></script>
	<script src="__PUBLIC__/editor_files/glsl.js"></script>
	<script src="__PUBLIC__/editor_files/esprima.js"></script>
	<script src="__PUBLIC__/editor_files/jsonlint.js"></script>
	<script src="__PUBLIC__/editor_files/glslprep.js"></script>

	<link rel="stylesheet" href="__PUBLIC__/editor_files/dialog.css">
	<link rel="stylesheet" href="__PUBLIC__/editor_files/show-hint.css">
	<link rel="stylesheet" href="__PUBLIC__/editor_files/tern.css">
	<script src="__PUBLIC__/editor_files/dialog.js"></script>
	<script src="__PUBLIC__/editor_files/show-hint.js"></script>
	<script src="__PUBLIC__/editor_files/tern.js"></script>
	<script src="__PUBLIC__/editor_files/acorn.js"></script>
	<script src="__PUBLIC__/editor_files/acorn_loose.js"></script>
	<script src="__PUBLIC__/editor_files/walk.js"></script>
	<script src="__PUBLIC__/editor_files/polyfill.js"></script>
	<script src="__PUBLIC__/editor_files/signal.js"></script>
	<script src="__PUBLIC__/editor_files/tern_002.js"></script>
	<script src="__PUBLIC__/editor_files/def.js"></script>
	<script src="__PUBLIC__/editor_files/comment.js"></script>
	<script src="__PUBLIC__/editor_files/infer.js"></script>
	<script src="__PUBLIC__/editor_files/doc_comment.js"></script>
	<script src="__PUBLIC__/editor_files/threejs.js"></script>

	<script src="__PUBLIC__/editor_files/signals.js"></script>
	<script src="__PUBLIC__/editor_files/ui_002.js"></script>
	<script src="__PUBLIC__/editor_files/ui.js"></script>

	<script src="__PUBLIC__/editor_files/app.js"></script>
	<script src="__PUBLIC__/editor_files/Player.js"></script>
	<script src="__PUBLIC__/editor_files/Script.js"></script>

	<script src="__PUBLIC__/editor_files/WebVR.js"></script>

	<script src="__PUBLIC__/editor_files/Storage.js"></script>

	<script src="__PUBLIC__/editor_files/Editor.js"></script>
	<script src="__PUBLIC__/editor_files/Config.js"></script>
	<script src="__PUBLIC__/editor_files/History.js"></script>
	<script src="__PUBLIC__/editor_files/Loader.js"></script>
	<script src="__PUBLIC__/editor_files/Menubar.js"></script>
	<script src="__PUBLIC__/editor_files/ButtomMenu.js"></script>
	<script src="__PUBLIC__/editor_files/Menubar.File.js"></script>
	<script src="__PUBLIC__/editor_files/Menubar.Edit.js"></script>
	<script src="__PUBLIC__/editor_files/Menubar.Add.js"></script>
	<script src="__PUBLIC__/editor_files/Menubar.Play.js"></script>
	<!-- <script src="js/Menubar.View.js"></script> -->
	<!--<script src="__PUBLIC__/editor_files/Menubar.Examples.js"></script>-->
	<!--<script src="__PUBLIC__/editor_files/Menubar.Help.js"></script>-->
	<script src="__PUBLIC__/editor_files/Menubar.Status.js"></script>
	<script src="__PUBLIC__/editor_files/Sidebar_010.js"></script>
	<script src="__PUBLIC__/editor_files/Sidebar.Scene.js"></script>
	<script src="__PUBLIC__/editor_files/Sidebar_role.js"></script>
	<script src="__PUBLIC__/editor_files/Sidebar_024.js"></script>
	<script src="__PUBLIC__/editor_files/Sidebar_004.js"></script>
	<script src="__PUBLIC__/editor_files/Sidebar_006.js"></script>
	<script src="__PUBLIC__/editor_files/Sidebar_012.js"></script>
	<script src="__PUBLIC__/editor_files/Sidebar_011.js"></script>
	<script src="__PUBLIC__/editor_files/Sidebar_009.js"></script>
	<script src="__PUBLIC__/editor_files/Sidebar_018.js"></script>
	<script src="__PUBLIC__/editor_files/Sidebar_013.js"></script>
	<script src="__PUBLIC__/editor_files/Sidebar_016.js"></script>
	<script src="__PUBLIC__/editor_files/Sidebar_008.js"></script>
	<script src="__PUBLIC__/editor_files/Sidebar_019.js"></script>
	<script src="__PUBLIC__/editor_files/Sidebar_002.js"></script>
	<script src="__PUBLIC__/editor_files/Sidebar_003.js"></script>
	<script src="__PUBLIC__/editor_files/Sidebar_021.js"></script>
	<script src="__PUBLIC__/editor_files/Sidebar_015.js"></script>
	<script src="__PUBLIC__/editor_files/Sidebar_022.js"></script>
	<script src="__PUBLIC__/editor_files/TeapotBufferGeometry.js"></script>
	<script src="__PUBLIC__/editor_files/Sidebar_007.js"></script>
	<script src="__PUBLIC__/editor_files/Sidebar_014.js"></script>
	<script src="__PUBLIC__/editor_files/Sidebar_020.js"></script>
	<script src="__PUBLIC__/editor_files/Sidebar_005.js"></script>
	<script src="__PUBLIC__/editor_files/Sidebar_017.js"></script>
	<script src="__PUBLIC__/editor_files/Sidebar_023.js"></script>
	<script src="__PUBLIC__/editor_files/Toolbar.js"></script>
	<script src="__PUBLIC__/editor_files/Viewport_002.js"></script>
	<script src="__PUBLIC__/editor_files/Viewport.js"></script>

	<script src="__PUBLIC__/editor_files/Command.js"></script>
	<script src="__PUBLIC__/editor_files/AddObjectCommand.js"></script>
	<script src="__PUBLIC__/editor_files/RemoveObjectCommand.js"></script>
	<script src="__PUBLIC__/editor_files/MoveObjectCommand.js"></script>
	<script src="__PUBLIC__/editor_files/SetPositionCommand.js"></script>
	<script src="__PUBLIC__/editor_files/SetRotationCommand.js"></script>
	<script src="__PUBLIC__/editor_files/SetScaleCommand.js"></script>
	<script src="__PUBLIC__/editor_files/SetValueCommand.js"></script>
	<script src="__PUBLIC__/editor_files/SetUuidCommand.js"></script>
	<script src="__PUBLIC__/editor_files/SetColorCommand.js"></script>
	<script src="__PUBLIC__/editor_files/SetGeometryCommand.js"></script>
	<script src="__PUBLIC__/editor_files/SetGeometryValueCommand.js"></script>
	<script src="__PUBLIC__/editor_files/MultiCmdsCommand.js"></script>
	<script src="__PUBLIC__/editor_files/AddScriptCommand.js"></script>
	<script src="__PUBLIC__/editor_files/RemoveScriptCommand.js"></script>
	<script src="__PUBLIC__/editor_files/SetScriptValueCommand.js"></script>
	<script src="__PUBLIC__/editor_files/SetMaterialCommand.js"></script>
	<script src="__PUBLIC__/editor_files/SetMaterialValueCommand.js"></script>
	<script src="__PUBLIC__/editor_files/SetMaterialColorCommand.js"></script>
	<script src="__PUBLIC__/editor_files/SetMaterialMapCommand.js"></script>
	<script src="__PUBLIC__/editor_files/SetSceneCommand.js"></script>

	<!-- <script type="text/javascript" src="https://www.dropbox.com/static/api/2/dropins.js" id="dropboxjs" data-app-key="qyqgfqd9j8z890t"></script> -->

	<script src="__PUBLIC__/editor_files/html2canvas.js"></script>
	<script src="__PUBLIC__/editor_files/three.js"></script>
	<script src="__PUBLIC__/KeyPan.js"></script>
	<script>
		window.URL = window.URL || window.webkitURL;
		window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;

		Number.prototype.format = function (){
			return this.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,");
		};
		var editor = new Editor();
		var viewport = new Viewport( editor );
		document.body.appendChild( viewport.dom );
		var keypan= new KeyPanControls(editor.camera);


//		var player=new Player(editor)
//		document.body.appendChild( player.dom )

		editor.storage.init( function () {
			editor.storage.get( function ( state ) {
				if ( isLoadingFromHash ) return;
				if ( state !== undefined ) {
					editor.fromJSON( state );
				}
				var selected = editor.config.getKey( 'selected' );
				if ( selected !== undefined ) {
					editor.selectByUuid( selected );
				}
			} );
			var timeout;
			function saveState( scene ) {
				if ( editor.config.getKey( 'autosave' ) === false ) {

					return;

				}

				clearTimeout( timeout );

				timeout = setTimeout( function () {

					editor.signals.savingStarted.dispatch();

					timeout = setTimeout( function () {

						editor.storage.set( editor.toJSON() );

						editor.signals.savingFinished.dispatch();

					}, 100 );

				}, 1000 );

			};

			var signals = editor.signals;

			signals.geometryChanged.add( saveState );
			signals.objectAdded.add( saveState );
			signals.objectChanged.add( saveState );
			signals.objectRemoved.add( saveState );
			signals.materialChanged.add( saveState );
			signals.sceneBackgroundChanged.add( saveState );
			signals.sceneFogChanged.add( saveState );
			signals.sceneGraphChanged.add( saveState );
			signals.scriptChanged.add( saveState );
			signals.historyChanged.add( saveState );

			signals.showModal.add( function ( content ) {

				modal.show( content );

			} );
			var rendererTypes = {
				'WebGLRenderer': THREE.WebGLRenderer,
				'CanvasRenderer': THREE.CanvasRenderer,
				'SVGRenderer': THREE.SVGRenderer,
				'SoftwareRenderer': THREE.SoftwareRenderer,
				'RaytracingRenderer': THREE.RaytracingRenderer
			};
			var renderer = new rendererTypes['WebGLRenderer']( {antialias: true} );
			renderer.gammaInput = false;
			renderer.gammaOutput = false;
			renderer.shadowMap.enabled = true;
			signals.rendererChanged.dispatch( renderer );
			onWindowResize();
			signals.startPlayer.dispatch()
		} );
		function onWindowResize( event ) {
			editor.signals.windowResize.dispatch();
		}
		window.addEventListener( 'resize', onWindowResize, false );
		var isLoadingFromHash = false;
		var hash = window.location.hash;
		if ( hash.substr( 1, 5 ) === 'file=' ) {
			var file = hash.substr( 6 );
			if ( confirm( 'Any unsaved data will be lost. Are you sure?' ) ) {
				var loader = new THREE.FileLoader();
				loader.crossOrigin = '';
				loader.load( file, function ( text ) {
					editor.clear();
					editor.fromJSON( JSON.parse( text ) );
				} );
				isLoadingFromHash = true;
			}
		}
	</script>
</block>